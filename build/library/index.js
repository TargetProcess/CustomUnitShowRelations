/*! v2.0.0 Build Tue Feb 20 2018 12:50:19 GMT+0300 (Belarus Standard Time) */
!function(){var mashup={},define=function(){var e,t,n,r=Array.prototype.slice.call(arguments,0);"string"==typeof r[0]?(n=r[0],e=r[1],t=r[2]):Array.isArray(r[0])&&(e=r[0],t=r[1]);var o=e.reduce(function(e,t){return e.addDependency(t)},tau.mashups);return o=o.addDependency(n+"/config"),o=o.addMashup(function(){var r=Array.prototype.slice.call(arguments,0);if(e.length>0&&1===r.length)throw new Error("Can't properly load dependencies for mashup \""+n+'", mashup is stopped.');return mashup.variables=r[r.length-1],r.length-e.length===2?mashup.config=r[r.length-2]:mashup.config={},Object.freeze&&(Object.freeze(mashup.variables),Object.freeze(mashup.config),Object.freeze(mashup)),t.apply(null,r)})};define("CustomUnitShowRelations",["jQuery","tau/api/board/v1","tau/configurator","Underscore","tau-intl","react","tau/storage/api.nocache","tau/api/actions/v1","libs/classNames","tau/core/global.bus"],function(__WEBPACK_EXTERNAL_MODULE_4__,__WEBPACK_EXTERNAL_MODULE_5__,__WEBPACK_EXTERNAL_MODULE_8__,__WEBPACK_EXTERNAL_MODULE_10__,__WEBPACK_EXTERNAL_MODULE_16__,__WEBPACK_EXTERNAL_MODULE_26__,__WEBPACK_EXTERNAL_MODULE_27__,__WEBPACK_EXTERNAL_MODULE_28__,__WEBPACK_EXTERNAL_MODULE_31__,__WEBPACK_EXTERNAL_MODULE_35__){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t.p=mashup.variables?mashup.variables.mashupPath:t.p,t(0)}([function(e,t,n){e.exports=n(3)},,,function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}var i=n(4),a=o(i),s=n(5),u=n(6),l=r(u),c=n(9),d=o(c),f=n(22),h=o(f),p=n(23),y=o(p),_=n(24),g=o(_);n(36);var m={isEmpty:!0,redraw:a["default"].noop,setConfig:a["default"].noop},v=function(e,t){m.isEmpty?m=new g["default"](e,t):m.setConfig(e,t)},b=function(){(0,s.onDetailsCreate)(function(e){v(d["default"],e.boardSettings)}),(0,s.onBoardCreate)(function(e){v(d["default"],e.board.boardSettings),e.onCellsUpdate(m.redraw),e.onCardDragging(m.redraw),e.onColumnResize(m.redraw),e.onPagingAnimated(m.redraw),e.onZoomLevelChanged(m.redraw),e.onExpandCollapseAxis(m.redraw)}),(0,s.onTimelineCreate)(function(e){var t=e.events;t.onRender.once(function(){v(h["default"],e.boardSettings),(0,a["default"])(".tau-timeline-canvas").scroll(function(e){m.update({y:e.target.scrollTop})}),(0,a["default"])(window).resize(function(){m.update()}),t.onCellUpdated.add(function(){m.redraw()}),t.onMoveCardToCell.add(function(){m.redraw()}),t.onRender.add(function(){m.redraw()}),t.onLocalDateRangeChanged.add(function(){m.redraw()}),t.onViewTimelineTracksCountChanged.add(function(){m.redraw()}),t.onPlannedDatesUpdating.add(function(e){m.updateRelationsForCard(e.data("id"))})})}),(0,s.onListCreate)(function(e){var t=e.events;t.onTreeRendered.once(function(){v(y["default"],e.boardSettings),t.onTreeRendered.add(function(){m.redraw()}),t.onTreeChanged.add(function(){m.redraw()}),t.onCardDragging.add(function(e){m.updateRelationsForCard(e.data("id"))}),t.onExpansionStateChanged.add(function(){m.redraw()})})})},w=function(){l.onHideEmptyLines(function(){return m.redraw()})};b(),w()},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_4__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_5__},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.onHideEmptyLines=void 0;var o=(n(7),n(4)),i=r(o);t.onHideEmptyLines=function(e){return(0,i["default"])(document).on("click",".i-role-hide-empty-lanes",function(){return e()})}},function(e,t,n){"use strict";var r=n(8),o=r.getBusRegistry(),i=function(e){return function(){e.apply(null,Array.prototype.slice.call(arguments).slice(1))}},a=function(e,t,n,r){var a=i(function(o){var i=o.bus;i.name===e&&i[r?"once":"on"](t,n)}),s=o.addEventListener("create",a);return o.addEventListener("destroy",i(function(r){var o=r.bus;o.name===e&&o.removeListener(t,n,s)})),{remove:function(){o.removeListener("create",a,s),o.getBusRegistry().getByName(e).then(function(e){e.removeListener(t,n,s)})}}},s=function(e,t,n){return a(e,t,n,!0)};e.exports={addBusListener:a,addBusListenerOnce:s}},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_8__},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(4),l=o(u),c=n(10),d=o(c),f=n(11),h=o(f),p=n(12),y=n(13),_=n(14),g=r(_),m=n(18),v=o(m),b=n(19),w=n(20),R=function(e){var t=e.width,n=e.height;return!t&&!n},C="http://www.w3.org/2000/svg",E=function(){function e(t){var n=this;i(this,e),this._getDrawRelationsForCard=function(){return(0,w.updateInteractionsData)(n.cardsByEntityId,n.arrows,n.viewMode),n._drawRelationsForCard},this._drawRelationsForCard=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n._processRelations(e).forEach(function(e){n.drawRelation(e,t||d["default"].first(n.cardsByEntityId[e.main.id]))})},this._getElementSelectFunction=function(e,t){return function(){return d["default"].first((n.cardsByEntityId[e]||[]).filter(function(e){return d["default"].isEqual(JSON.parse(e.dataset.dataItem).coords||"",JSON.parse(t.dataset.dataItem).coords||"")}))}},this._updateRelationArrow=function(e){var t=e.fromEl(),r=e.toEl();if(t&&r){e.$lines.show();var o=n._getClientRects(t,r),i=o.cardRect,a=o.targetRect,s=o.tableRect,u=o.gridRect,l=n._getPositionFromRect(i,s),c=n._getPositionFromRect(a,s),f=n._getIntersectionPoints(l,c,u,e.relation);if(!f)return void e.$lines.hide();if(!n._isValidPoints(f)||R(i)||R(a))e.$lines.remove(),d["default"].compact(n.arrows);else{var h=g.generateBezierCoords(f.start,f.end,e.relation.directionType===v["default"].inbound);e.$lines.each(function(e,t){return t.setAttributeNS(null,"d",h)})}}else e.$lines.hide()},this.update=function(e){n.$svg&&(e&&(n.offset=e.y),n.updateGridAndTable()&&(n.arrows.forEach(n._updateRelationArrow),n.applyRelationsAndCards([n.highlightCardsByRelations()])))},this.redraw=function(){n.updateGridAndTable()&&(n.arrows=[],n.$svg.find("path.line, path.helperLine").remove(),n.getAndSaveRelations().then(function(){n.$svg&&(n.applyRelationsAndCards([n._getDrawRelationsForCard(),n.highlightCardsByRelations()]),(0,w.redrawInteractionsHighlights)(n.arrows,n.cardsByEntityId,n.viewMode))}))},this.updateRelationsForCard=function(e){n.arrows.filter(function(t){var n=t.main,r=t.slave;return n===e||r===e}).forEach(n._updateRelationArrow)},this.cardsByEntityId=[],this.offset=0,this.groupedRelations=[],this.$table=null,this.arrows=[],this.viewMode=h["default"].BOARD,this.dataFetcher=t}return s(e,[{key:"_appendSvgToGrid",value:function(e){this.$grid.append(e)}},{key:"createSvg",value:function(){var e=(0,y.createSvgFromTemplate)(this.$table.width(),this.$table.height());return this._appendSvgToGrid(e),e}},{key:"updateGridAndTable",value:function(){return this.$grid=(0,l["default"])(".i-role-grid"),this.$table=this._getTable(),this.$grid.length>0&&this.$table.length>0&&(this.cardsByEntityId=this._getCardsGroupedByEntityId(),this.$svg||(this.$svg=this.createSvg()),!0)}},{key:"_getTable",value:function(){return this.$grid.children("table")}},{key:"_getCardsGroupedByEntityId",value:function(){return d["default"].groupBy(this.$grid.find(".i-role-card, .tau-sortable__placeholder").toArray(),function(e){return e.getAttribute("data-entity-id")})}},{key:"getAndSaveRelations",value:function(){var e=this,t=Object.keys(this.cardsByEntityId).filter(function(e){return e.match(/^\d+$/)});return this.dataFetcher.load(t).then(function(t){var n=t.filter(function(t){var n=t.entity.id;return e.cardsByEntityId[n]}).map(function(e,t){return a({index:t},e)});e.relations=n,e.groupedRelations=d["default"].groupBy(n,function(e){var t=e.main.id;return t})})}},{key:"highlightCardsByRelations",value:function(){return(0,b.getHighlightCardsByRelations)(this.$grid,this.cardsByEntityId,this.viewMode)}},{key:"applyRelationsAndCards",value:function(e){var t=this;Object.keys(this.groupedRelations).forEach(function(n){var r=t.groupedRelations[n],o=t.cardsByEntityId[n]||[];o.forEach(function(t){e.forEach(function(e){return e(r,t)})})})}},{key:"drawRelation",value:function(e,t){var n=this,r=this.cardsByEntityId[e.entity.id];r&&this._processTargetCards(r).forEach(function(r){return n.drawRelationArrow(e,t,r)})}},{key:"_processRelations",value:function(e){return e}},{key:"_processTargetCards",value:function(e){return e}},{key:"_getClientRects",value:function(e,t){return{cardRect:e.getBoundingClientRect(),targetRect:t.getBoundingClientRect(),tableRect:this.$table[0].getBoundingClientRect(),gridRect:this.$table[0].getBoundingClientRect()}}},{key:"_getPositionFromRect",value:function(e,t){return{x:e.left-t.left,y:e.top-t.top,height:e.height,width:e.width}}},{key:"_getIntersectionPoints",value:function(e,t){return(0,p.intersectRects)(e,t)}},{key:"_isValidPoints",value:function(e){return!d["default"].some([e.start.x,e.start.y,e.end.x,e.end.y],function(e){return d["default"].isNaN(e)})}},{key:"_createLine",value:function(e){var t=document.createElementNS(C,"path");return t.setAttribute("class",e.cssClass||""),t.setAttributeNS(null,"d",e.bezierCoords),t.setAttributeNS(null,"stroke",e.stroke||"grey"),t.setAttributeNS(null,"fill",e.fill||"none"),t.setAttributeNS(null,"stroke-width",e.strokeWidth||"1"),t}},{key:"drawRelationArrow",value:function(e,t,n){var r=this._getClientRects(t,n),o=r.cardRect,i=r.targetRect,a=r.tableRect,s=r.gridRect;if(!R(o)&&!R(i)){var u=e.main.id,c=e.entity.id,d=e.relationType.name,f=e.directionType,h={lines:[],main:u,slave:c,arrowId:u+"-"+c,relation:e,fromEl:this._getElementSelectFunction(u,t),toEl:this._getElementSelectFunction(c,n)},p=this._getPositionFromRect(o,a),y=this._getPositionFromRect(i,a),_=this._getIntersectionPoints(p,y,s,e);if(_&&this._isValidPoints(_)){var m=g.generateBezierCoords(_.start,_.end,f===v["default"].inbound),b=g.getRelationColor(d),C=this._createLine({cssClass:"helperLine",bezierCoords:m,stroke:b,strokeWidth:"6"}),E=this._createLine({cssClass:"line",bezierCoords:m,stroke:b,strokeWidth:"1.2"});f===v["default"].inbound?(E.setAttributeNS(null,"marker-start","url(#"+g.getInboundRelationTypeMarkerEndId(e.relationType)+")"),E.setAttributeNS(null,"marker-end","url(#"+g.getRelationTypeMarkerStartId(e.relationType)+")")):(E.setAttributeNS(null,"marker-start","url(#"+g.getRelationTypeMarkerStartId(e.relationType)+")"),E.setAttributeNS(null,"marker-end","url(#"+g.getOutboundRelationTypeMarkerEndId(e.relationType)+")")),this.$svg.append(E),this.$svg.append(C);var S=(0,l["default"])(C).add(E);h.$lines=S,(0,w.bindArrowHighlightInteractions)(S,u,c,d),this.arrows.push(h)}}}},{key:"removeAll",value:function(){(0,b.cleanGridAndCards)(this.$grid),(0,w.unbindAndResetHighlights)(),this.removeSvg()}},{key:"removeSvg",value:function(){this.$svg&&(this.$svg.remove(),this.$svg=null)}}]),e}();t["default"]=E},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_10__},function(e,t){"use strict";var n={LIST:"newlist",BOARD:"board",DETAILS:"list",TIMELINE:"timeline"};e.exports=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){var n=e.x1,r=e.x2,o=e.y1,i=e.y2,a=t.x1,s=t.x2,u=t.y1,l=t.y2,c=(o*(l-u)*(r-n)-u*(i-o)*(s-a)+(a-n)*(l-u)*(i-o))/((l-u)*(r-n)-(i-o)*(s-a)),d=(n*(s-a)*(i-o)-a*(r-n)*(l-u)+(u-o)*(s-a)*(r-n))/((s-a)*(i-o)-(r-n)*(l-u));return{x:d,y:c}},r=function(e){return[{x1:e.x,y1:e.y,x2:e.x+e.width,y2:e.y},{x1:e.x+e.width,y1:e.y,x2:e.x+e.width,y2:e.y+e.height},{x1:e.x,y1:e.y+e.height,x2:e.x+e.width,y2:e.y+e.height},{x1:e.x,y1:e.y,x2:e.x,y2:e.y+e.height}]},o=function(e,t,n){return e>=Math.floor(t)&&e<=Math.ceil(n)},i=function(e,t,n){var r=o(e.x,Math.min(t.x1,t.x2),Math.max(t.x1,t.x2)),i=o(e.x,Math.min(n.x1,n.x2),Math.max(n.x1,n.x2)),a=o(e.y,Math.min(t.y1,t.y2),Math.max(t.y1,t.y2)),s=o(e.y,Math.min(n.y1,n.y2),Math.max(n.y1,n.y2));return r&&i&&a&&s},a=function(e,t){var o=r(e),a=void 0,s=void 0;return o.forEach(function(e){var r=n(e,t);s=r,i(r,t,e)&&(a=r)}),a||s};t.intersectRects=function(e,t){var n={x1:e.x+e.width/2,y1:e.y+e.height/2,x2:t.x+t.width/2,y2:t.y+t.height/2};return{start:a(e,n),end:a(t,n)}}},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.createSvgFromTemplate=void 0;var i=n(4),a=o(i),s=n(14),u=r(s),l=n(17),c=o(l),d=n(15),f=o(d);t.createSvgFromTemplate=function(e,t){return(0,a["default"])((0,c["default"])({relationTypes:f["default"],width:e,height:t,getRelationTypeColor:u.getRelationTypeColor,getRelationTypeMarkerStartId:u.getRelationTypeMarkerStartId,getInboundRelationTypeMarkerEndId:u.getInboundRelationTypeMarkerEndId,getOutboundRelationTypeMarkerEndId:u.getOutboundRelationTypeMarkerEndId}))}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.generateBezierCoords=t.getRelationColor=t.getRelationTypeColor=t.getOutboundRelationTypeMarkerEndId=t.getInboundRelationTypeMarkerEndId=t.getRelationTypeMarkerStartId=void 0;var o=n(15),i=r(o),a=(t.getRelationTypeMarkerStartId=function(e){var t=e.name;return t+"_start"},t.getInboundRelationTypeMarkerEndId=function(e){var t=e.name;return t+"_inbound_end"},t.getOutboundRelationTypeMarkerEndId=function(e){var t=e.name;return t+"_outbound_end"},t.getRelationTypeColor=function(e){var t=e.style;return t.color});t.getRelationColor=function(e){return a(i["default"].filter(function(t){var n=t.name;return n===e})[0])},t.generateBezierCoords=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=["M"+e.x+","+e.y],o=Math.PI/48*(n?-1:1),i=Math.cos(o),a=Math.sin(o),s={x:(e.x+t.x)/2,y:(e.y+t.y)/2},u={x:(s.x-e.x)*i-(s.y-e.y)*a+e.x,y:(s.x-e.x)*a+(s.y-e.y)*i+e.y},l=u.x+","+u.y;return r.concat("C"+l).concat(l).concat(t.x+","+t.y).join(" ")}},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}Object.defineProperty(t,"__esModule",{value:!0});var o=n(16),i=r(o);t["default"]=[{label:i.formatMessage("Dependencies"),name:"Dependency",style:{color:"#6abcd0"}},{label:i.formatMessage("Blockers"),name:"Blocker",style:{color:"#c30010"}},{label:i.formatMessage("Relations"),name:"Relation",style:{color:"#8e98a9"}},{label:i.formatMessage("Links"),name:"Link",style:{color:"#4d7fbe"}},{label:i.formatMessage("Duplicates"),name:"Duplicate",style:{color:"#e79010"}}]},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_16__},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<svg xmlns="http://www.w3.org/2000/svg" class="mashupCustomUnitShowRelations__svg"\r\n     viewBox="0 0 '+(null==(__t=width||0)?"":__t)+" "+(null==(__t=height||0)?"":__t)+'"\r\n     width="'+(null==(__t=width||0)?"":__t)+'px" height="'+(null==(__t=height||0)?"":__t)+'px">\r\n    <defs>\r\n        ',relationTypes.forEach(function(e){__p+='\r\n\r\n        <marker viewBox="0 0 10 10" id="'+(null==(__t=getRelationTypeMarkerStartId(e))?"":__t)+'" markerWidth="17" markerHeight="17"\r\n                refX="5" refY="5" markerUnits="userSpaceOnUse">\r\n            <circle cx="5" cy="5" r="2" style="stroke: none; fill:'+(null==(__t=getRelationTypeColor(e))?"":__t)+';"/>\r\n        </marker>\r\n        <marker viewBox="0 0 10 10" id="'+(null==(__t=getOutboundRelationTypeMarkerEndId(e))?"":__t)+'" markerWidth="20" markerHeight="20"\r\n                orient="auto" refY="2" refX="0" markerUnits="userSpaceOnUse">\r\n            <path d="M0,0 L4,2 0,4" fill="'+(null==(__t=getRelationTypeColor(e))?"":__t)+'"/>\r\n        </marker>\r\n        <marker viewBox="0 0 10 10" id="'+(null==(__t=getInboundRelationTypeMarkerEndId(e))?"":__t)+'" markerWidth="20" markerHeight="20"\r\n                orient="auto" refY="2" refX="4" markerUnits="userSpaceOnUse">\r\n            <path d="M0,0 L4,2 0,4" fill="'+(null==(__t=getRelationTypeColor(e))?"":__t)+'" transform="rotate(180 2 2)"/>\r\n        </marker>\r\n\r\n        '}),__p+="\r\n    </defs>\r\n</svg>\r\n";return __p}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={inbound:"inbound",outbound:"outbound"}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getHighlightCardsByRelations=t.cleanGridAndCards=void 0;var o=n(4),i=r(o),a=[],s=function(e){e.hasClass("tau-selected")&&(e.removeClass("tau-selected"),a=a.concat(e.data("id")))},u=function(e,t,n){var r=(0,i["default"])(e);if("timeline"===n){var o=r.parent(".i-role-timeline-card-holder");o.length&&(o.addClass("mashupCustomUnitShowRelations__related"),o.addClass("mashupCustomUnitShowRelations__"+t),s(o))}s(r),r.addClass("mashupCustomUnitShowRelations__related")},l=function(e){["related","related-inbound","related-outbound","source"].forEach(function(t){var n="mashupCustomUnitShowRelations__"+t;e.find("."+n).removeClass(n)})};t.cleanGridAndCards=function(e){e&&(e.removeClass("mashupCustomUnitShowRelations"),e.removeClass("mashupCustomUnitShowRelations-highlighted"),l(e))},t.getHighlightCardsByRelations=function(e,t,n){var r=function(e){return t[e]||[]},o=function(e){r(e.entity.id).forEach(function(t){u(t,e.directionType,n)})};return e.addClass("mashupCustomUnitShowRelations"),l(e),function(e,t){var n=(0,i["default"])(t);n.addClass("mashupCustomUnitShowRelations__source"),s(n),e.forEach(o)}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.unbindAndResetHighlights=t.updateInteractionsData=t.redrawInteractionsHighlights=t.bindArrowHighlightInteractions=void 0;var o=n(4),i=r(o),a=n(21),s=r(a),u="mashupCustomUnitShowRelations__highlighted",l="mashupCustomUnitShowRelations-highlighted mashupCustomUnitShowRelations__svg-highlighted",c=[],d=[],f=[],h=[],p=void 0,y={},_=function(){return(0,i["default"])(".i-role-grid")},g=function(){return _().addClass(l)},m=function(){return _().removeClass(l)},v=function(e){return(0,i["default"])(e).filter(".line").attr("class","line line__highlighted")},b=function(e){return(0,i["default"])(e).filter(".line").attr("class","line")},w=function(e){return f.filter(function(t){var n=t.arrowId;return n===e}).map(function(e){var t=e.$lines;return t})},R=function(e){c.indexOf(e)===-1&&w(e).forEach(v),c.push(e)},C=function(e){c.splice(c.indexOf(e),1),c.indexOf(e)===-1&&w(e).forEach(b)},E=function(e){var t=(0,i["default"])(e);t.length&&(g(),t.addClass(u),"timeline"===p&&t.parent(".i-role-timeline-card-holder").addClass(u))},S=function(e){var t=(0,i["default"])(e);t.removeClass(u),"timeline"===p&&t.parent(".i-role-timeline-card-holder").removeClass(u),d.length||m()},x=function(e){d.indexOf(e)===-1&&h[e].forEach(E),d.push(e)},T=function(e){d.splice(d.indexOf(e),1),d.indexOf(e)===-1&&h[e].forEach(S)},O=function(e,t){return e+"-"+t},k=function(e,t,n){[String(e),String(t)].forEach(x),n&&R(O(e,t))},M=function(e,t,n){[String(e),String(t)].forEach(T),n&&C(O(e,t))},U=function(e,t,n){return function(){var r=O(e,t),o=!y[r];return y[r]=o,(0,s["default"])({name:o?"fix-arrow":"unfix-arrow",fromId:e,toId:t,relationType:n}),o?k(e,t,!0):M(e,t,!0),!1}},A=function(){[].concat(c).forEach(C),[].concat(d).forEach(T)};t.bindArrowHighlightInteractions=function(e,t,n,r){e.on("mouseenter",function(){return k(t,n)}),e.on("mouseleave",function(){return M(t,n)}),e.on("mousedown",U(t,n,r))},t.redrawInteractionsHighlights=function(){var e=[].concat(c),t=[].concat(d);A(),e.forEach(R),t.forEach(x)},t.updateInteractionsData=function(e,t,n){h=e,f=t,p=n,_().on("mousedown.highlights",function(e){var t=e.target;(0,i["default"])(t).parents().hasClass("i-role-card")||((0,s["default"])({name:"reset-highlights"}),A(),y={})})},t.unbindAndResetHighlights=function(){y={},A(),_().off("mousedown.highlights")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),o=function(e,t){e&&t()};t["default"]=function(e){var t=e.name,n=e.fromId,i=e.toId,a=e.relationType,s={name:"relations-"+t,tags:["relations"]};o(n,function(){return(0,r.extend)(s,{fromId:n})}),o(i,function(){return(0,r.extend)(s,{toId:i})}),o(a,function(){return(0,r.extend)(s,{relationType:a})}),window.taus&&window.taus.track(s)}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":u(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":u(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(10),d=r(c),f=n(4),h=r(f),p=n(9),y=r(p),_=n(12),g=n(11),m=r(g),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._getElementSelectFunction=function(e,t){return function(){return d["default"].first((n.cardsByEntityId[e]||[]).filter(function(e){return e.sectionType===t.sectionType&&t.coords&&d["default"].isEqual(e.coords||"",t.coords||"")}))}},n.viewMode=m["default"].TIMELINE,n}return s(t,e),l(t,[{key:"_appendSvgToGrid",value:function(e){this.$grid.find(".tau-timeline.i-role-timeline-column").append(e)}},{key:"_getCardsGroupedByEntityId",value:function(){var e=d["default"].groupBy([].concat(o(this.$grid.find(".tau-backlog-body .i-role-card, .tau-backlog-body .tau-sortable__placeholder").toArray().map(function(e){return d["default"].extend(e,{sectionType:"backlog",holder:e,coords:JSON.parse(e.dataset.dataItem).coords})})),o(this.$grid.find(".tau-card-planner:not(.tau-section-invisible) .i-role-card, .tau-card-planner:not(.tau-section-invisible) .tau-sortable__placeholder").toArray().map(function(e){return d["default"].extend(e,{sectionType:"planned",holder:e.parentElement,coords:JSON.parse(e.dataset.dataItem).coords})})),o(this.$grid.find(".tau-timeline-card > .tau-card-holder:not(.tau-section-invisible) .i-role-card").toArray().map(function(e){return d["default"].extend(e,{sectionType:"actual",holder:e,coords:JSON.parse(e.dataset.dataItem).coords})}))),function(e){return e.getAttribute("data-entity-id")});return d["default"].keys(e).reduce(function(t,n){var r=d["default"].chain(e[n]).pluck("sectionType").uniq().value(),o=r.filter(function(e){return"backlog"===e}).length>0;return r.length>1&&!o?t[n]=e[n].filter(function(e){return"actual"===e.sectionType}):t[n]=e[n],t},{})}},{key:"_getTable",value:function(){return this.$grid.find(".tau-timeline-flow")}},{key:"_getPositionFromRect",value:function(e,t){return{x:e.left-t.left,y:e.top-t.top-this.offset,height:e.height,width:e.width}}},{key:"_getIntersectionPoints",value:function(e,t,n,r){var o=(0,_.intersectRects)(e,t);return Math.abs(o.start.x-o.end.x)<10&&(t.x>e.x?o.end.x=o.start.x+10:o.end.x=o.start.x-10),o}},{key:"_getClientRects",value:function(e,t){var n={cardRect:(e.holder||e).getBoundingClientRect(),targetRect:(t.holder||t).getBoundingClientRect(),tableRect:this.$table[0].getBoundingClientRect(),gridRect:this.$grid[0].getBoundingClientRect()};if("actual"===e.sectionType||"actual"===t.sectionType){var r=this.$table.find(".tau-timeline-now-marker"),o=r[0].getBoundingClientRect();[n.cardRect,n.targetRect].forEach(function(e){e.left<o.left&&e.width>o.left-e.left&&(e.width=o.left-e.left)})}return n}},{key:"_processTargetCards",value:function(e){return e.map(function(e){var t=(0,h["default"])(e).parent(),n=t.hasClass("i-role-timeline-planner-card-holder")?t[0]:e;return n.sectionType=e.sectionType,n.holder=e.holder,n.coords=e.coords,n})}}]),t}(y["default"]);t["default"]=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":s(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":s(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(10),d=r(c),f=n(9),h=r(f),p=n(18),y=r(p),_=n(12),g=n(11),m=r(g),v=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.viewMode=m["default"].LIST,n}return a(t,e),l(t,[{key:"_appendSvgToGrid",value:function(e){this.$grid.find(".i-role-unit-editor-popup-position-within").append(e)}},{key:"_getTable",value:function(){return this.$grid.find(".tau-list-level-0")}},{key:"_getIntersectionPoints",value:function(e,t,n,r){if(Math.abs(t.y-e.y)>20){var o=(0,_.intersectRects)(e,t),i=50*((r.index||0)+1);return r.directionType===y["default"].inbound?(o.start.x=e.x+i,o.end.x=t.x+i):(o.start.x=e.x+n.width-i-50,o.end.x=t.x+n.width-i-50),o.start.y===o.end.y&&(t.y>e.y?(o.start.y=o.start.y-5,o.end.y=o.end.y+5):(o.start.y=o.start.y+5,o.end.y=o.end.y-5)),o}return null}},{key:"_processRelations",value:function(e){return e=d["default"].groupBy(e,function(e){return e.directionType}),e=d["default"].map(e,function(e){return e.map(function(e,t){return u({index:t},e)})}),e=d["default"].reduce(e,function(e,t){return e.concat(t)},[])}}]),t}(h["default"]);t["default"]=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(10),s=r(a),u=n(4),l=(r(u),n(25)),c=r(l),d=n(34),f=r(d),h=function(){function e(t,n){var r=this;o(this,e),this.executeDrawOperation=function(e){r.legendModel&&r.legendModel.isShown&&e()},this.update=s["default"].throttle(function(e){r.executeDrawOperation(r.relationsDraw.update.bind(r.relationsDraw,e))},30),this.redraw=s["default"].throttle(function(){r.executeDrawOperation(r.relationsDraw.redraw)},100),this.updateRelationsForCard=s["default"].throttle(function(e){return r.executeDrawOperation(r.relationsDraw.updateRelationsForCard.bind(r.relationsDraw,e))},20,{leading:!1}),this.dataFetcher=new f["default"],this.dataFetcher.updated.add(function(){return r.dataFetcher.refresh().then(function(){return r.redraw()})}),this.setConfig(t,n)}return i(e,[{key:"setConfig",value:function(e,t){this.relationsDraw&&(this.relationsDraw.removeAll(),delete this.relationsDraw),this.legendModel&&(this.legendModel.destroy(),delete this.legendModel),this.dataFetcher.subscribeForRelationsUpdate(),this.relationsDraw=new e(this.dataFetcher),this.legendModel=new c["default"](this.relationsDraw,this.dataFetcher,t)}}]),e}();t["default"]=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=n(10),u=r(s),l=n(11),c=r(l),d=n(26),f=r(d),h=n(15),p=r(h),y=n(27),_=r(y),g=n(28),m=r(g),v=n(21),b=r(v),w=n(29),R=r(w),C="showRelations",E="userData",S=p["default"].map(function(e){return a({},e,{show:!0})}),x=u["default"].Callbacks();m["default"].addControl(f["default"].createElement(R["default"],{onUpdateLegend:x}));var T=function(){function e(t,n,r){var i=this;o(this,e),this.changeRelationTypes=function(e){var t=e.name,n=void 0===t?"":t,r=e.show,o=void 0!==r&&r;(0,b["default"])({name:(o?"add":"remove")+"-"+n.toLowerCase()}),i.relations.filter(function(e){var t=e.name;return t===n})[0].show=o,i.dataFetcher.setFilterConfig(i.relations),i.saveToStorage(),i.refresh()},this.changeShowState=function(e){(0,b["default"])({name:e?"show":"hide"}),i.isShown=e,i.saveToStorage(),i.refresh()},this.boardSettings=r,this.restStorage=new _["default"],this.relationsDrawer=t,this.dataFetcher=n,this.saveToStorage=u["default"].throttle(this._saveToStorage,1e3,{leading:!1}),this.initializeSubscriptions(),this.setInitialData(r),this.loadSettings().then(function(){return i.refresh()})}return i(e,[{key:"initializeSubscriptions",value:function(){var e=this;m["default"].onShow(function(){e.refresh()})}},{key:"setInitialData",value:function(e){this._userKey="user"+(window.loggedUser||{id:null}).id+"-"+e.settings.id,this.isShown=!1,this.relations=u["default"].deepClone(S),this.dataFetcher.setFilterConfig(this.relations)}},{key:"data",value:function(){return{isVisible:this.boardSettings.settings.viewMode!==c["default"].DETAILS,onUpdateLegend:x,isExpanded:this.isShown,relations:this.relations,metadata:this.metadata,onExpansionStateChange:this.changeShowState,
onRelationTypeSelect:this.changeRelationTypes}}},{key:"_saveToStorage",value:function(){this.restStorage.data(C,this._userKey,{relations:JSON.stringify({expanded:this.isShown,metadata:this.metadata,relations:this.relations.map(function(e){return{name:e.name,show:e.show}})})})}},{key:"loadSettings",value:function(){var e=this;return this.restStorage.select(C,{$where:{key:this._userKey},$fields:[E]}).then(function(t){var n=t.data&&t.data[0]&&t.data[0].userData;if(n){var r=JSON.parse(n.relations);u["default"].isUndefined(r.expanded)||(e.isShown=r.expanded),r.relations&&(e.relations=e.relations.map(function(e){var t=r.relations.filter(function(t){return t.name===e.name})[0];return t&&(e.show=t.show),e})),e.dataFetcher.setFilterConfig(e.relations)}})}},{key:"refresh",value:function(){this.isShown===!1?this.relationsDrawer.removeAll():this.relationsDrawer.redraw(),x.fire(this.data())}},{key:"destroy",value:function(){m["default"].unbind(),delete this.relationsDrawer}}]),e}();t["default"]=T},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_26__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_27__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_28__},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(26),l=r(u),c=n(30),d=r(c),f=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state=e,n.props.onUpdateLegend.add(function(e){n.setState(e)},n),n}return a(t,e),s(t,[{key:"componentWillUnmount",value:function(){this.props.onUpdateLegend.remove(this)}},{key:"render",value:function(){return l["default"].createElement(d["default"],this.state)}}]),t}(l["default"].Component);t["default"]=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(26),l=r(u),c=n(31),d=r(c),f=n(32),h=r(f),p=n(33),y=r(p),_=function(e){function t(){var e,n,r,a;o(this,t);for(var s=arguments.length,u=Array(s),l=0;l<s;l++)u[l]=arguments[l];return n=r=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),r.onClick=function(){r.props.onExpansionStateChange(!r.props.isExpanded)},a=n,i(r,a)}return a(t,e),s(t,[{key:"render",value:function(){var e=this.props.isExpanded,t={"tau-btn":!0,"i-role-show-relations":!0,"i-role-board-tooltip":!0,"tau-checked":e},n={"board-actions__item__text":!0},r=(0,d["default"])(t),o=(0,d["default"])(n),i=e?h["default"].BUTTON_TITLE_EXPANDED:h["default"].BUTTON_TITLE_COLLAPSED,a=e?h["default"].BUTTON_TEXT_EXPANDED:h["default"].BUTTON_TEXT_COLLAPSED;return this.props.isVisible?l["default"].createElement("div",{className:"board-actions__group board-actions__group--controls board-actions__group--visual-encoding i-role-board-actions-group"},l["default"].createElement("div",{className:"board-actions__item board-actions__item--two-column action-show-relations"},l["default"].createElement("span",{className:o},"Relations"),l["default"].createElement("div",{className:"board-actions__item__control"},l["default"].createElement("button",{onClick:this.onClick,type:"button",className:r,title:i},l["default"].createElement("span",{className:"tau-btn__text"},a)))),this.props.isExpanded&&l["default"].createElement(y["default"],{relations:this.props.relations,onSelect:this.props.onRelationTypeSelect})):null}}]),t}(l["default"].Component);t["default"]=_},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_31__},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}Object.defineProperty(t,"__esModule",{value:!0});var o=n(16),i=r(o),a=i.formatMessage("Click to hide relations"),s=i.formatMessage("Click to show relations"),u=i.formatMessage("Hide"),l=i.formatMessage("Show");t["default"]={BUTTON_TITLE_EXPANDED:a,BUTTON_TITLE_COLLAPSED:s,BUTTON_TEXT_EXPANDED:u,BUTTON_TEXT_COLLAPSED:l}},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(26),c=o(l),d=n(16),f=(r(d),function(e){return"relations-legend__item-name--type-"+e.name.toLowerCase()}),h=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),u(t,[{key:"onSelect",value:function(e){this.props.onSelect(e)}},{key:"render",value:function(){var e=this;return c["default"].createElement("ul",{className:"relations-legend relations-legend--expanded"},this.props.relations.map(function(t){return c["default"].createElement("li",{key:t.name,className:"relations-legend__item"},c["default"].createElement("label",{className:"tau-checkbox relations-legend__checkbox"},c["default"].createElement("span",{className:"tau-checkbox relations-legend__item-name tau-checkbox  "+f(t)},t.label),c["default"].createElement("input",{onChange:e.onSelect.bind(e,{name:t.name,show:!t.show}),checked:t.show,type:"checkbox",className:"i-role-toggle-global-rules",value:"on"}),c["default"].createElement("i",{className:"tau-checkbox__icon"})))}))}}]),t}(c["default"].Component);t["default"]=h},function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(4),u=o(s),l=n(10),c=o(l),d=n(35),f=r(d),h=n(15),p=o(h),y=n(8),_=o(y),g=function(e,t){return u["default"].ajax({type:"get",url:e,contentType:"application/json; charset=utf-8",dataType:"json",data:t})},m=function e(t,n){return g(t,n).then(function(t){var n=t.Items,r=t.Next;return r?e(r).then(function(e){return n.concat(e)}):n})},v=function(e,t){return m(_["default"].getApplicationPath()+"/api/v1/"+e,t)},b=function(e,t,n){return{directionType:n,relationType:{name:e.RelationType.Name},entity:{id:e[t].Id},main:{id:e.Master.Id}}},w=null,R=c["default"].Callbacks();f.get().on("configurator.ready",function(e,t){if(w){var n=t.storeFactory.getStore();w.id!==n.id&&(w=n,R.fire())}else w=t.storeFactory.getStore()});var C=function(){function e(){var t=this;i(this,e),this.entityIds=[],this._relations=[],this.setFilterConfig([]),this.updated=c["default"].Callbacks(),R.add(function(){return t.subscribeForRelationsUpdate()}),this.subscribeForRelationsUpdate()}return a(e,[{key:"load",value:function(e){var t=this;return c["default"].intersection(e,this.entityIds).length===e.length?Promise.resolve(this.getRelationsFiltered()):(this.entityIds=e,this._getRelationsByIdsInternal(e).then(function(e){return t._relations=e}).then(function(){return t.getRelationsFiltered()}))}},{key:"refresh",value:function(){return this._getRelationsByIdsInternal(this._relations.map(function(e){return e.entity.id}))}},{key:"setFilterConfig",value:function(e){this.filterConfig=e.filter(function(e){return e.show}).map(function(e){return p["default"].filter(function(t){return t.name===e.name})[0].name})}},{key:"getRelationsFiltered",value:function(){var e=this;return this._relations.filter(function(t){return e.filterConfig.some(function(e){return e===t.relationType.name})})}},{key:"getRelationsByIds",value:function(e){return this._relations.filter(function(t){return e.some(t.entity.id)})}},{key:"_onRelationsChanged",value:function(){var e=this;this._getRelationsByIdsInternal(this.entityIds).then(function(t){e._relations=t,e.updated.fire()})}},{key:"subscribeForRelationsUpdate",value:function(){var e=this;this.store&&this.store.unbind(this),this.store=w,this.store.on({type:"relation",eventName:"afterSave",listener:this},function(){e._onRelationsChanged()},this),this.store.on({type:"relation",eventName:"afterRemove",listener:this},function(){e._onRelationsChanged()},this)}},{key:"_getRelationsByIdsInternal",value:function(e){return e.length?v("relations",{where:"Master.Id in ("+e.join(",")+")",include:"[Slave[Id],Master[Id],RelationType[Name]]"}).then(function(e){return e.map(function(e){return b(e,"Slave","outbound")})}).fail(function(){return console.warn("Error loading relations for Relation Visualisation"),[]}):Promise.resolve([])}}]),e}();t["default"]=C},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_35__},function(e,t,n){var r=n(37);"string"==typeof r&&(r=[[e.id,r,""]]);n(39)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(38)(),t.push([e.id,".mashupCustomUnitShowRelations .i-role-card,.mashupCustomUnitShowRelations .tau-show-more-cards-trigger{opacity:.3;transition:opacity .3s cubic-bezier(.4,0,.2,1) .2s}.mashupCustomUnitShowRelations .tau-list-more .tau-list-more-inner{z-index:8}.mashupCustomUnitShowRelations__related,.mashupCustomUnitShowRelations__source{transition:opacity .1s cubic-bezier(.4,0,.2,1)!important;opacity:1!important;z-index:9;position:relative}.mashupCustomUnitShowRelations-highlighted .mashupCustomUnitShowRelations__related,.mashupCustomUnitShowRelations-highlighted .mashupCustomUnitShowRelations__source{transition:opacity .3s cubic-bezier(.4,0,.2,1) .2s!important;opacity:.3!important}.mashupCustomUnitShowRelations-highlighted .mashupCustomUnitShowRelations__highlighted{transition:opacity .1s cubic-bezier(.4,0,.2,1)!important;opacity:1!important}.mashupCustomUnitShowRelations.tau-board-list-view .i-role-card{opacity:1!important;transition:none!important;height:0;padding-bottom:33px;background-clip:content-box}.mashupCustomUnitShowRelations.tau-board-list-view .tau-list-line{opacity:.3;transition:opacity .3s cubic-bezier(.4,0,.2,1) .2s;background:inherit}.mashupCustomUnitShowRelations.tau-board-list-view .mashupCustomUnitShowRelations__related,.mashupCustomUnitShowRelations.tau-board-list-view .mashupCustomUnitShowRelations__source{z-index:auto!important}.mashupCustomUnitShowRelations.tau-board-list-view .mashupCustomUnitShowRelations__related .tau-list-line,.mashupCustomUnitShowRelations.tau-board-list-view .mashupCustomUnitShowRelations__source .tau-list-line{transition:opacity .1s cubic-bezier(.4,0,.2,1)!important;opacity:1!important;z-index:9;position:relative}.mashupCustomUnitShowRelations.tau-board-list-view .mashupCustomUnitShowRelations-highlighted .mashupCustomUnitShowRelations__related .tau-list-line,.mashupCustomUnitShowRelations.tau-board-list-view .mashupCustomUnitShowRelations-highlighted .mashupCustomUnitShowRelations__source .tau-list-line{transition:opacity .3s cubic-bezier(.4,0,.2,1) .2s!important;opacity:.3!important}.mashupCustomUnitShowRelations.tau-board-list-view .mashupCustomUnitShowRelations-highlighted .mashupCustomUnitShowRelations__highlighted .tau-list-line{transition:opacity .1s cubic-bezier(.4,0,.2,1)!important;opacity:1!important}.mashupCustomUnitShowRelations-legend{position:absolute;top:0;left:0;z-index:9;background:#fff;font-size:12px;padding:5px 15px 15px;opacity:.7}.mashupCustomUnitShowRelations-legend:hover{opacity:1}.mashupCustomUnitShowRelations-legend h3{font-weight:600;font-size:12px}.mashupCustomUnitShowRelations-legend__line+.mashupCustomUnitShowRelations-legend__line{margin-top:10px}.mashupCustomUnitShowRelations-legend__link{color:#28428b;cursor:pointer}.mashupCustomUnitShowRelations__svg{position:absolute;top:0;left:0;z-index:25;pointer-events:none;overflow:visible}.mashupCustomUnitShowRelations__svg .line{transition:opacity .1s cubic-bezier(.4,0,.2,1),stroke-width .1s cubic-bezier(.4,0,.2,1);pointer-events:all;cursor:pointer}.mashupCustomUnitShowRelations__svg .line:hover{opacity:1;transition:opacity .1s cubic-bezier(.4,0,.2,1),stroke-width .1s cubic-bezier(.4,0,.2,1)}.mashupCustomUnitShowRelations__svg .line:hover+.helperLine{opacity:.3}.mashupCustomUnitShowRelations__svg .helperLine{transition:opacity .1s cubic-bezier(.4,0,.2,1);opacity:0;pointer-events:none;cursor:pointer}.mashupCustomUnitShowRelations__svg-highlighted .mashupCustomUnitShowRelations__highlighted{transition:opacity .1s cubic-bezier(.4,0,.2,1)!important;opacity:1!important}.mashupCustomUnitShowRelations__svg-highlighted path.line{transition:opacity .3s cubic-bezier(.4,0,.2,1) .2s,stroke-width .1s cubic-bezier(.4,0,.2,1);opacity:.3}.mashupCustomUnitShowRelations__svg-highlighted path.line__highlighted{transition:opacity .1s cubic-bezier(.4,0,.2,1),stroke-width .1s cubic-bezier(.4,0,.2,1);opacity:1;stroke-width:2.2}.i-role-grid .tau-board-unit_type_relations-counter-in-out{cursor:pointer!important}.new-feature-label .tau-board:not(.i-role-dashboard-page):not(.i-role-customReport-container) .tau-actions-btn:after{font-size:9px;color:#89b923;content:'NEW';position:relative;top:-3px;left:2px}.tau-app-main-pane.new-feature-label:after{content:none}",""])},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var n=this[t];n[2]?e.push("@media "+n[2]+"{"+n[1]+"}"):e.push(n[1])}return e.join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},o=0;o<this.length;o++){var i=this[o][0];"number"==typeof i&&(r[i]=!0)}for(o=0;o<t.length;o++){var a=t[o];"number"==typeof a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}},function(e,t,n){function r(e,t){for(var n=0;n<e.length;n++){var r=e[n],o=d[r.id];if(o){o.refs++;for(var i=0;i<o.parts.length;i++)o.parts[i](r.parts[i]);for(;i<r.parts.length;i++)o.parts.push(s(r.parts[i],t))}else{for(var a=[],i=0;i<r.parts.length;i++)a.push(s(r.parts[i],t));d[r.id]={id:r.id,refs:1,parts:a}}}}function o(e){for(var t=[],n={},r=0;r<e.length;r++){var o=e[r],i=o[0],a=o[1],s=o[2],u=o[3],l={css:a,media:s,sourceMap:u};n[i]?n[i].parts.push(l):t.push(n[i]={id:i,parts:[l]})}return t}function i(){var e=document.createElement("style"),t=p();return e.type="text/css",t.appendChild(e),e}function a(){var e=document.createElement("link"),t=p();return e.rel="stylesheet",t.appendChild(e),e}function s(e,t){var n,r,o;if(t.singleton){var s=_++;n=y||(y=i()),r=u.bind(null,n,s,!1),o=u.bind(null,n,s,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=a(),r=c.bind(null,n),o=function(){n.parentNode.removeChild(n),n.href&&URL.revokeObjectURL(n.href)}):(n=i(),r=l.bind(null,n),o=function(){n.parentNode.removeChild(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else o()}}function u(e,t,n,r){var o=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=g(t,o);else{var i=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}function l(e,t){var n=t.css,r=t.media;t.sourceMap;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function c(e,t){var n=t.css,r=(t.media,t.sourceMap);r&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var o=new Blob([n],{type:"text/css"}),i=e.href;e.href=URL.createObjectURL(o),i&&URL.revokeObjectURL(i)}var d={},f=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},h=f(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),p=f(function(){return document.head||document.getElementsByTagName("head")[0]}),y=null,_=0;e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=h());var n=o(e);return r(n,t),function(e){for(var i=[],a=0;a<n.length;a++){var s=n[a],u=d[s.id];u.refs--,i.push(u)}if(e){var l=o(e);r(l,t)}for(var a=0;a<i.length;a++){var u=i[a];if(0===u.refs){for(var c=0;c<u.parts.length;c++)u.parts[c]();delete d[u.id]}}}};var g=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}()}])})}();